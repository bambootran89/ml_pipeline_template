# Conditional Branching Pipeline
# Selects model based on data characteristics

pipeline:
  name: "conditional_model_selection"

  steps:
    # Stage 0: Data Loading
    - id: "load_data"
      type: "data_loader"
      enabled: true
    # Stage 1: Preprocessing
    - id: "preprocess"
      type: "preprocessor"
      enabled: true
      depends_on: ["load_data"]
    # Stage 2: Data Analysis (compute data_size)
    # This step adds data_size to context
    - id: "analyze_data"
      type: "generic_model"
      enabled: true
      depends_on: ["preprocess"]
      model_name: "kmean"  # Placeholder - can be custom
      output_as_feature: false
      wiring:
        inputs:
          data: "preprocessed_data"
        outputs:
          data_size: "data_size"  # Stores len(df) in context
    # Stage 3: Conditional Model Selection
    - id: "model_selector"
      type: "branch"
      enabled: true
      depends_on: ["analyze_data"]
      condition:
        key: "data_size"
        operator: ">"
        value: 1000
      if_true:
        # Use deep model for large datasets
        id: "deep_model"
        type: "generic_model"
        model_name: "tft"
        model_type: "dl"
        hyperparams:
          hidden_size: 64
          num_layers: 2
        wiring:
          inputs:
            data: "preprocessed_data"
          outputs:
            model: "final_model"
            predictions: "final_preds"
      if_false:
        # Use simple model for small datasets
        id: "simple_model"
        type: "generic_model"
        model_name: "xgboost"
        model_type: "ml"
        hyperparams:
          n_estimators: 50
          max_depth: 3
        wiring:
          inputs:
            data: "preprocessed_data"
          outputs:
            model: "final_model"
            predictions: "final_preds"
    # Stage 4: Evaluation (uses output from branch)
    - id: "evaluate"
      type: "evaluator"
      enabled: true
      depends_on: ["model_selector"]
      model_step_id: "model_selector"
      wiring:
        inputs:
          model: "final_model"
        outputs:
          metrics: "evaluation_metrics"
