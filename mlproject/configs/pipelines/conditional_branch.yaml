# Conditional Model Selection Pipeline
# Demonstrates conditional execution based on data characteristics
#
# Flow:
#   load_data → preprocess → check_size → [TFT | XGBoost] → evaluate
#
# If dataset is large (>10000 samples), use deep learning (TFT).
# Otherwise, use gradient boosting (XGBoost).

pipeline:
  name: "conditional_model_selection"
  steps:
    # Stage 1: Data Loading
    - id: "load_data"
      type: "data_loader"
      enabled: true

    # Stage 2: Preprocessing
    - id: "preprocess"
      type: "preprocessor"
      enabled: true
      depends_on: ["load_data"]

    # Stage 3: Conditional Model Selection
    - id: "model_selection"
      type: "branch"
      enabled: true
      depends_on: ["preprocess"]
      condition:
        key: "data_size"      # Check this context key
        operator: ">"         # Comparison operator
        value: 10000          # Threshold value

      # Execute if condition is TRUE (large dataset)
      if_true:
        id: "train_tft"
        type: "trainer"
        wiring:
          outputs:
            model: "selected_model"
            datamodule: "selected_dm"

      # Execute if condition is FALSE (small dataset)
      if_false:
        id: "train_xgb"
        type: "trainer"
        wiring:
          outputs:
            model: "selected_model"
            datamodule: "selected_dm"

    # Stage 4: Evaluation (works with either model)
    - id: "evaluate"
      type: "evaluator"
      enabled: true
      depends_on: ["model_selection"]
      wiring:
        inputs:
          model: "selected_model"
          datamodule: "selected_dm"

    # Stage 5: Log Results
    - id: "log_results"
      type: "logger"
      enabled: true
      depends_on: ["evaluate"]
