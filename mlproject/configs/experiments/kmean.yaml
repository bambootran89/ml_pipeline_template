# @package _global_

# -------------------------------------------------------------------
# 1. Defaults override
# Remove default TimeSeries data configuration
# -------------------------------------------------------------------
defaults:
  - override /base/data: null
  - ../base/model.yaml
  - ../base/training.yaml
  - ../base/tuning.yaml

# -------------------------------------------------------------------
# 2. MLflow tracking & model registry
# -------------------------------------------------------------------
mlflow:
  tracking_uri: mlruns
  experiment_name: Tabular_Titanic_Kmean
  run_name_prefix: kmean_cls
  enabled: true

  registry:
    enabled: true
    model_name: titanic_kmean_model

  artifacts:
    log_model: true
    log_scaler: true
    log_config: true
    log_metrics: true
    log_plots: true

  autolog:
    enabled: true
    log_models: false


# -------------------------------------------------------------------
# 3. Preprocessing configuration
# -------------------------------------------------------------------
preprocessing:
  steps:
    - name: fill_missing
      method: mean  # Options: mean, median, mode, ffill
      columns:  # Optional, mặc định là tất cả numeric columns
        - Age
        - Fare
    - name: fill_missing
      method: mode
      columns:
        - Sex
        - Embarked
        - Pclass
    # Step 2: Label encoding cho categorical
    - name: label_encoding
      columns:
        - Sex
        - Embarked
        - Pclass
    # Step 3: Scale numerical features
    - name: normalize
      method: zscore
      columns:
        - Age
        - Fare


  # Dataset split ratios (used for non-CV pipelines)
  split:
    train: 0.8
    val: 0.0
    test: 0.2

  artifacts_dir: mlproject/artifacts/preprocessing


# -------------------------------------------------------------------
# 4. Data configuration (Tabular)
# -------------------------------------------------------------------
data:
  type: tabular
  path: mlproject/data/titanic.csv

  # Selected feature columns
  features:
    - "Pclass"  # 1, 2, 3
    - "Age"     # 22.0, 38.0...
    - "SibSp"   # 1, 0...
    - "Parch"   # 0, 1...
    - "Fare"    # 7.25, 71.83...
    - "Sex"
    - "Embarked"
  # Number of folds for cross-validation
  n_folds: 5


# -------------------------------------------------------------------
# 5. Model configuration (XGBoost - Binary Classification)
# -------------------------------------------------------------------
model:
  name: kmean
  params:
    n_clusters: 3
    init_method: k-means++
    random_state: 42
    max_iter: 100
    max_depth: 6
    tol: 1e-4

    # macOS stability setting
    n_jobs: 1


# -------------------------------------------------------------------
# 6. Evaluation & hyperparameter tuning
# -------------------------------------------------------------------
evaluation:
  type: clustering
  metrics:
    - inertia
    - silhouette_score

tuning:
  n_trials: 30
  metric: val_inertia
  direction: minimize
  storage: sqlite:///mlflow.db


# 7. Experiment metadata
experiment:
  name: 'Tabular_Titanic_Kmean'
  type: 'clustering'
  model: "kmean"
  model_type: "ml"
  hyperparams:
    type: "clustering"
    args:
      n_clusters: 3
      init_method: k-means++
      random_state: 42
      max_iter: 100
      max_depth: 6
      tol: 1e-4
